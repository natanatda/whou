<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-Mapper.dtd">
<mapper namespace="whou.secproject.mapper.MemberMapper">
	<insert id="insert">
		insert into whou_user (num, email) values(user_seq.NEXTVAL, #{email})
	</insert>
	
	<insert id="insert2">
		insert into user_info (num, email) values(userInfo_seq.NEXTVAL, #{email})
	</insert>
	
	<insert id="insertPro">
		insert into whou_user (num, email, pw, name, birth_year, tel, join_type) 
		<if test = "join_type != ''">
			 values(user_seq.NEXTVAL, #{email}, 'null', #{name}, #{birth_year}, #{tel}, #{join_type})
		</if>
		<if test = "join_type == ''">
			values(user_seq.NEXTVAL, #{email}, #{pw}, #{name}, #{birth_year}, #{tel}, 'whoU')
		</if>
	</insert>
	
	<select id="count" resultType="int">
		select count(*) from whou_user where tel = #{tel}
	</select>
	
	<select id="check" resultType="int">
		select count(*) from whou_user where email = #{email}
	</select>
	
	<select id="join_type" resultType="String">
		select join_type from whou_user where email = #{email}
	</select>
	
	<select id="login" resultType="String">
		select pw from whou_user where email = #{email}
	</select>
	
	<select id="getEmail" resultType="String">
		select email from whou_user where name = #{name} and tel = #{tel}
	</select>
	
	<select id="getCerti" resultType="String">
	    select jmfldnm from certificate where jmfldnm like '%' || #{txt} || '%'
	</select>
	
	<select id="getMajor" resultType="String">
		select MCLASS from major where MCLASS like '%' || #{major} || '%' and univSe = #{univSe}
	</select>
	
	<update id="updateInfo">
		update user_info set CERTIFICATE=#{combinedCerti}, SCHOOL_MAJOR=#{combinedMajor} where email = #{memId}
	</update>
	
	
	<!-- 마이페이지 -->
	<select id="getAptitudeRank" resultType="whou.secproject.component.RecommandInfoDTO">
		select * from recommand_info where num = ${userNum}
	</select>
	
	<select id="getBook" resultType="String">
		select books from user_info where email = #{memId}
	</select>
	
	<update id="updateBook">
		update user_info set books = #{books} where email =#{memId}
	</update>

	
	
	<!--  sj write  -->
	<!-- user_info의 num을 이용하여 cunsulting_num 컬럼 값 get -->
	<select id="getCunsultingNum" resultType="Integer">
		select cunsulting_num from user_info where num = #{userNum}
	</select>
	<!-- 역량 보완법을 위해 크롤링한 결과에서 21번 테스트의 역량별 수치 가져옴 -->
	<select id="getRecentTest21" resultType="String">
		SELECT test21_2 FROM user${userNum}_test_result WHERE test_date IN(SELECT max(test_date) FROM user${userNum}_test_result WHERE test_num=21)
	</select>
	<!--  역량 보완 방법을 DB에서 가져옴 -->
	<select id="getTestReinforcement" resultType="whou.secproject.component.TestReinforcementDTO">
		SELECT * FROM test_reinforcement WHERE num=#{num}
	</select>
	
	<select id="getUser" resultType="whou.secproject.component.MemberDTO">
		select * from whou_user where num = ${userNum}
	</select>
	
	<select id="getJob" resultType="whou.secproject.component.Job_infoDTO">
		select job_nm, works, job_cd from job_info where job_cd = #{job_cd}
	</select>
	
</mapper>
