<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-Mapper.dtd">
<mapper namespace="whou.secproject.mapper.AptitudeMapper">
	
	<!-- 크롤링한 직업검사 결과를 DB에 insert -->
	<insert id="crawlingInsert">
		insert into user1_test_result (
			index_num, test_num, test_answers, test_date,
			test21_1, test21_2, test21_3, test21_4, test21_5,test21_6, test21_7, test21_8, test21_9, test21_10,
			test25_1, test25_2, test25_3, test25_4, test25_5,test25_6, test25_7, test25_8, test25_9, test25_10,
			test27_1, test27_2, test27_3, test27_4, test27_5,test27_6, test27_7, test27_8, test27_9, test27_10,
			test31_1, test31_2, test31_3, test31_4, test31_5,test31_6, test31_7, test31_8, test31_9, test31_10
		)
		values (
			user1_test_result_seq.nextval, #{test_num}, #{test_answers}, sysdate,
			#{test21_1}, #{test21_2}, #{test21_3}, #{test21_4},	#{test21_5},#{test21_6}, #{test21_7}, #{test21_8}, #{test21_9},	#{test21_10},
			#{test25_1}, #{test25_2}, #{test25_3}, #{test25_4},	#{test25_5},#{test25_6}, #{test25_7}, #{test25_8}, #{test25_9},	#{test25_10},
			#{test27_1}, #{test27_2}, #{test27_3}, #{test27_4},	#{test27_5},#{test27_6}, #{test27_7}, #{test27_8}, #{test27_9},	#{test27_10},
			#{test31_1}, #{test31_2}, #{test31_3}, #{test31_4},	#{test31_5},#{test31_6}, #{test31_7}, #{test31_8}, #{test31_9},	#{test31_10}
		)
	</insert>
	
	<!-- 임시저장한 직업검사 결과를 DB에 insert -->
	<insert id="temporarySaveInsert">
		INSERT INTO user1_test_temporary_save (
			test_num, test_name, test_answers, test_date
		)VALUES(
			#{test_num}, #{test_name}, #{test_answers}, sysdate
		)
	</insert>
	
	<!-- 검사지 메인에 출력할 최근검사일과 검사 횟수 -->
	<select id="getRecentTest" resultType="whou.secproject.component.AptitudeTestValueDTO">
		SELECT test_num, max(test_date) AS max_test_date, count(*) AS count FROM user1_test_result GROUP BY test_num ORDER BY test_num
	</select>
	
	
	<!-- 모든 임시저장 값 -->
	<select id="getTemporarySave" resultType="whou.secproject.component.AptitudeTestTemporarySaveDTO">
		SELECT * FROM user1_test_temporary_save
		<where>
			<if test="test_num > 0">
				test_num = ${test_num}
			</if>
		</where>
	</select>
	
	
	
	<!-- 임시저장의 test_num이 같으면 업데이트  -->
	<update id="temporarySaveUpdate">
		UPDATE user1_test_temporary_save 
			SET test_answers=#{test_answers}, test_date=sysdate 
			WHERE test_num=#{test_num}
	</update>
	
	<!-- 임시저장한 검사를 제출했다면 삭제  -->
	<delete id="temporarySaveDelete">
		DELETE FROM user1_test_temporary_save WHERE test_num=#{test_num}
	</delete>
	
	<!-- userNum 검색 -->
	<select id="userNumSelect" resultType="int">
		SELECT num FROM whou_user WHERE email = #{memId}
	</select>
	
	<!-- userNum 저장 -->
	<insert id="userNumInsert">
		INSERT INTO recommand_info (num) VALUES (#{userNum})
	</insert>
	
	<!-- userNum Count -->
	<select id="userNumCount" resultType="int">
		SELECT count(*) FROM recommand_info WHERE num = #{userNum}
	</select>
	
	<!-- 가치관 검사지 유형별 직업리스트 seq 검색 -->
	<select id="valuesJob" resultType="String">
		SELECT seq FROM job_unique_num2 WHERE job_nm = #{job_nm}
	</select>
	
	<!-- 가치관 직업번호 저장 -->
	<select id="valuesInsert" >
		insert into values_common (job_cd, value_aim) values (#{result},'성취지향')
	</select>
	
	<select id="jobSelect" resultType="String">
		SELECT seq FROM job_unique_num2 WHERE job_nm = #{jobListItem}
	</select>
	
	<select id="aptdSelect" resultType="String">
		SELECT sort_values FROM aptd_factor WHERE sort_name = #{sortName}
	</select>
	
	<!-- 흥미 직업번호 저장 -->
	<update id="interestUpdate">
		UPDATE recommand_info 
		SET interest_name1=#{dtoRe.interest_name1}, interest_name2=#{dtoRe.interest_name2}, interest_name3=#{dtoRe.interest_name3}, 
			interest_job1=#{dtoRe.interest_job1}, interest_job2=#{dtoRe.interest_job2}, interest_job3=#{dtoRe.interest_job3} 
		WHERE num=#{userNum}
	</update>
	<!-- 적성 직업번호 저장 -->
	<update id="aptitudeUpdate">
		UPDATE recommand_info 
		SET aptitude_name1=#{dtoRe.aptitude_name1}, aptitude_name2=#{dtoRe.aptitude_name2}, aptitude_name3=#{dtoRe.aptitude_name3}, 
			aptitude_job1=#{dtoRe.aptitude_job1}, aptitude_job2=#{dtoRe.aptitude_job2}, aptitude_job3=#{dtoRe.aptitude_job3} 
		WHERE num=#{userNum}
	</update>
	<!-- 가치관 차트점수 저장 -->
	<update id="valuesUpdate">
		UPDATE recommand_info SET values_score=#{score} WHERE num=#{userNum}
	</update>
	
</mapper>